{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/types/PluginActions.ts","webpack:///./src/index.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","PluginActions","currentPage","figma","selectedItems","selection","root","main","ui","onmessage","onPluginMessage","command","openWindow","copy","setup","about","closePlugin","action","configParams","getPluginConfig","nodes","convertNodesToJSON","findItemsForLink","length","fileId","pluginAction","fileName","showUI","__html__","width","height","callPluginAction","msg","_a","type","message","notify","nodeName","trim","savePluginConfig","payload","pluginEvent","postMessage","origin","scaling","undefined","hideUI","getPluginData","Number","oldVal","setPluginData","config","String","linkItems","selectedItem","parents","getParentsList","keys","Array","from","id","item","prev_id","prev_item","push","uniqueBy","filter","node","map","Map","_parent","set","parent","arr","values"],"mappings":"aACE,IAAIA,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUC,QAGnC,IAAIC,EAASJ,EAAiBE,GAAY,CACzCG,EAAGH,EACHI,GAAG,EACHH,QAAS,IAUV,OANAI,EAAQL,GAAUM,KAAKJ,EAAOD,QAASC,EAAQA,EAAOD,QAASF,GAG/DG,EAAOE,GAAI,EAGJF,EAAOD,QAKfF,EAAoBQ,EAAIF,EAGxBN,EAAoBS,EAAIV,EAGxBC,EAAoBU,EAAI,SAASR,EAASS,EAAMC,GAC3CZ,EAAoBa,EAAEX,EAASS,IAClCG,OAAOC,eAAeb,EAASS,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEZ,EAAoBkB,EAAI,SAAShB,GACX,qBAAXiB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAeb,EAASiB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,KAQvDrB,EAAoBsB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQrB,EAAoBqB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,kBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFA1B,EAAoBkB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOrB,EAAoBU,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRzB,EAAoB6B,EAAI,SAAS1B,GAChC,IAAIS,EAAST,GAAUA,EAAOqB,WAC7B,WAAwB,OAAOrB,EAAO,YACtC,WAA8B,OAAOA,GAEtC,OADAH,EAAoBU,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRZ,EAAoBa,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG/B,EAAoBkC,EAAI,IAIjBlC,EAAoBA,EAAoBmC,EAAI,S,sCClF9C,IAAIC,EAAX,kCACA,SAAWA,GACPA,EAAc,QAAU,OACxBA,EAAc,SAAW,QACzBA,EAAc,SAAW,QAH7B,CAIGA,IAAkBA,EAAgB,M,kCCLrC,uBACA,MAAMC,EAAcC,MAAMD,YACpBE,EAAgBF,EAAYG,UAC5BC,EAAOH,MAAMG,KAEnB,SAASC,IAEL,OADAJ,MAAMK,GAAGC,UAAYC,EACbP,MAAMQ,SACV,IAAK,oBACD,OAAOC,EAAW,OAAcC,MAEpC,IAAK,WACD,OAAOD,EAAW,OAAcE,OAEpC,IAAK,QACD,OAAOF,EAAW,OAAcG,OAGxCZ,MAAMa,YAAY,0BAEtB,SAASJ,EAAWK,GAChB,MAAMC,EAAeC,IACfC,EAAQC,EAAmBC,KACjC,IAAKF,IAAUA,EAAMG,OACjB,OAAOpB,MAAMa,YAAY,sCAExBE,EAAaM,QAAUP,IAAW,OAAcJ,OACjDI,EAAS,OAAcH,OAE3B,MAAMW,EAAe,CACjBR,SACAG,QACAF,eACAQ,SAAUpB,EAAK9B,MAEnB,OAAQyC,GACJ,KAAK,OAAcH,MACfX,MAAMwB,OAAOC,SAAU,CACnBC,MAAO,IACPC,OAAQ,MAEZC,EAAiBN,GACjB,MAEJ,KAAK,OAAcV,MACfZ,MAAMwB,OAAOC,SAAU,CACnBC,MAAO,IACPC,OAAQ,MAEZC,EAAiBN,GACjB,MAEJ,KAAK,OAAcZ,KACfV,MAAMwB,OAAOC,SAAU,CACnBC,MAAO,EACPC,OAAQ,IAEZC,EAAiBN,GACjB,OAIZ,SAASf,EAAgBsB,GACrB,IAAIC,EACJ,MAAMb,EAAQC,EAAmBC,KACjC,GAAiB,YAAbU,EAAIE,MAAsBF,EAAIG,QAC9BhC,MAAMiC,OAAOJ,EAAIG,SAAW,SAG3B,GAAiB,WAAbH,EAAIE,KAIR,GAAiB,gBAAbF,EAAIE,KAIR,GAAiB,iBAAbF,EAAIE,KAoBb/B,MAAMa,kBApBD,CACD,IAAIgB,EACJ,GAAKZ,EAAMG,OAGN,GAAqB,IAAjBH,EAAMG,OAAc,CACzB,MAAMc,IAAiC,QAAnBJ,EAAKb,EAAM,UAAuB,IAAPa,OAAgB,EAASA,EAAGzD,OAAS,IAAI8D,OAEpFN,EADAK,EACM,sBAAsBA,yBAGtB,0CAIVL,EAAM,wCAAwCZ,EAAMG,eAZpDS,EAAM,mDAcV7B,MAAMa,YAAYgB,QApBlBO,EAAiBP,EAAIQ,cAJrBrC,MAAMa,cA6Bd,SAASe,EAAiBU,GACtBtC,MAAMK,GAAGkC,YAAYD,EAAa,CAAEE,OAAQ,MAEhD,SAASxB,IAKL,MAAMD,EAAe,CACjBM,OAAQ,GACRoB,aAASC,EACTC,YAAQD,GAOZ,GALA3B,EAAaM,OAASlB,EAAKyC,cAAc,iBACzC7B,EAAa0B,QAAUtC,EAAKyC,cAAc,kBAC1C7B,EAAa4B,OACTE,OAAO1C,EAAKyC,cAAc,mBAAqB,GAE9C7B,EAAaM,OAAQ,CACtB,MAAMyB,EAAS3C,EAAKyC,cAAc,eAC9BE,IACA/B,EAAaM,OAASyB,EACtB3C,EAAK4C,cAAc,cAAe,KAI1C,IAAKhC,EAAa0B,QAAS,CACvB,MAAMK,EAAS3C,EAAKyC,cAAc,wBAC9BE,IACA/B,EAAa0B,QAAUK,EACvB3C,EAAK4C,cAAc,uBAAwB,KAGnD,OAAOhC,EAEX,SAASqB,EAAiBY,GACtB7C,EAAK4C,cAAc,gBAAiBC,EAAO3B,QAC3ClB,EAAK4C,cAAc,iBAAkBC,EAAOP,SAAW,IACvDtC,EAAK4C,cAAc,gBAAiBE,OAAOD,EAAOL,QAAU,IAEhE,SAASxB,IACL,IAAI+B,EAAY,GAChB,GAAKjD,EAAcmB,OAIf,IAAK,MAAM+B,KAAgBlD,EAAe,CACtC,MAAMmD,EAAUC,EAAeF,GACzBG,EAAOC,MAAMC,KAAKJ,EAAQE,QAChC,IAAK,IAAIxF,EAAIwF,EAAKlC,OAAS,EAAGtD,GAAK,EAAGA,IAAK,CACvC,MAAM2F,EAAKH,EAAKxF,GACV4F,EAAON,EAAQzE,IAAI8E,GACnBE,EAAUL,EAAKxF,EAAI,GACnB8F,EAAYR,EAAQzE,IAAIgF,GAC9B,GAAkB,SAAdD,EAAK3B,KAAT,CAEI6B,GAAgC,UAAnBA,EAAU7B,KACvBmB,EAAUW,KAAKD,GAEfV,EAAUW,KAAKH,GACnB,aAjBRR,EAAUW,KAAK7D,MAAMD,aAqBzB,OAAO+D,EAASZ,EAAUa,OAAQxE,GAAMA,GAAI,MAEhD,SAAS8D,EAAeW,GACpB,MAAMC,EAAM,IAAIC,IAChB,IAAKF,EACD,OAAOC,EACX,IAAIE,EAAUH,EACd,MAAOG,EACHF,EAAIG,IAAID,EAAQV,GAAIU,GACpBA,EAAUA,EAAQV,KAAOtD,EAAKsD,QAAKf,EAAYyB,EAAQE,OAE3D,OAAOJ,EAEX,SAAS/C,EAAmBD,GACxB,OAAOA,EAAMgD,IAAKD,IAAS,CACvBP,GAAIO,EAAKP,GACTpF,KAAM2F,EAAK3F,QAGnB,SAASyF,EAASQ,EAAKjF,GACnB,MAAO,IAAI,IAAI6E,IAAII,EAAIL,IAAKP,GAAS,CAACA,EAAKrE,GAAMqE,KAAQa,UAnL7DnE","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"ffb4\");\n","export var PluginActions;\n(function (PluginActions) {\n    PluginActions[\"copy\"] = \"copy\";\n    PluginActions[\"setup\"] = \"setup\";\n    PluginActions[\"about\"] = \"about\";\n})(PluginActions || (PluginActions = {}));\n","import { PluginActions } from './types/PluginActions';\nconst currentPage = figma.currentPage;\nconst selectedItems = currentPage.selection;\nconst root = figma.root;\nmain();\nfunction main() {\n    figma.ui.onmessage = onPluginMessage;\n    switch (figma.command) {\n        case 'copyPrototypeLink': {\n            return openWindow(PluginActions.copy);\n        }\n        case 'settings': {\n            return openWindow(PluginActions.setup);\n        }\n        case 'about': {\n            return openWindow(PluginActions.about);\n        }\n    }\n    figma.closePlugin('ERROR: Unknown command');\n}\nfunction openWindow(action) {\n    const configParams = getPluginConfig();\n    const nodes = convertNodesToJSON(findItemsForLink());\n    if (!nodes || !nodes.length) {\n        return figma.closePlugin('ERROR: Could not get the link item');\n    }\n    if (!configParams.fileId && action === PluginActions.copy) {\n        action = PluginActions.setup;\n    }\n    const pluginAction = {\n        action,\n        nodes,\n        configParams,\n        fileName: root.name,\n    };\n    switch (action) {\n        case PluginActions.setup: {\n            figma.showUI(__html__, {\n                width: 295,\n                height: 350,\n            });\n            callPluginAction(pluginAction);\n            break;\n        }\n        case PluginActions.about: {\n            figma.showUI(__html__, {\n                width: 282,\n                height: 380,\n            });\n            callPluginAction(pluginAction);\n            break;\n        }\n        case PluginActions.copy: {\n            figma.showUI(__html__, {\n                width: 0,\n                height: 0,\n            });\n            callPluginAction(pluginAction);\n            break;\n        }\n    }\n}\nfunction onPluginMessage(msg) {\n    var _a;\n    const nodes = convertNodesToJSON(findItemsForLink());\n    if (msg.type === 'message' && msg.message) {\n        figma.notify(msg.message || '');\n        return;\n    }\n    else if (msg.type === 'cancel') {\n        figma.closePlugin();\n        return;\n    }\n    else if (msg.type === 'save-config') {\n        savePluginConfig(msg.payload);\n        return;\n    }\n    else if (msg.type === 'links-copied') {\n        let msg;\n        if (!nodes.length) {\n            msg = 'There are no nodes selected to generate the link';\n        }\n        else if (nodes.length === 1) {\n            const nodeName = (((_a = nodes[0]) === null || _a === void 0 ? void 0 : _a.name) || '').trim();\n            if (nodeName) {\n                msg = `Prototype link of '${nodeName}' copied to clipboard`;\n            }\n            else {\n                msg = 'Prototype link copied to clipboard';\n            }\n        }\n        else {\n            msg = `Prototype links copied to clipboard (${nodes.length})`;\n        }\n        figma.closePlugin(msg);\n        return;\n    }\n    figma.closePlugin();\n}\nfunction callPluginAction(pluginEvent) {\n    figma.ui.postMessage(pluginEvent, { origin: '*' });\n}\nfunction getPluginConfig() {\n    // INFO: Private plugin method\n    // Only if you are making a private plugin (publishing it internally to your\n    // company that is on an Organization plan) you can get the file key\n    // const fileId: string = figma.fileKey\n    const configParams = {\n        fileId: '',\n        scaling: undefined,\n        hideUI: undefined,\n    };\n    configParams.fileId = root.getPluginData('config.fileId');\n    configParams.scaling = root.getPluginData('config.scaling');\n    configParams.hideUI =\n        Number(root.getPluginData('config.hideUI')) || 0;\n    // backward compatibility\n    if (!configParams.fileId) {\n        const oldVal = root.getPluginData('shareFileId');\n        if (oldVal) {\n            configParams.fileId = oldVal;\n            root.setPluginData('shareFileId', '');\n        }\n    }\n    // backward compatibility\n    if (!configParams.scaling) {\n        const oldVal = root.getPluginData('urlQueryParamScaling');\n        if (oldVal) {\n            configParams.scaling = oldVal;\n            root.setPluginData('urlQueryParamScaling', '');\n        }\n    }\n    return configParams;\n}\nfunction savePluginConfig(config) {\n    root.setPluginData('config.fileId', config.fileId);\n    root.setPluginData('config.scaling', config.scaling || '');\n    root.setPluginData('config.hideUI', String(config.hideUI || 0));\n}\nfunction findItemsForLink() {\n    let linkItems = [];\n    if (!selectedItems.length) {\n        linkItems.push(figma.currentPage);\n    }\n    else {\n        for (const selectedItem of selectedItems) {\n            const parents = getParentsList(selectedItem);\n            const keys = Array.from(parents.keys());\n            for (let i = keys.length - 1; i >= 0; i--) {\n                const id = keys[i];\n                const item = parents.get(id);\n                const prev_id = keys[i - 1];\n                const prev_item = parents.get(prev_id);\n                if (item.type !== 'PAGE')\n                    continue;\n                if (prev_item && prev_item.type === 'FRAME')\n                    linkItems.push(prev_item);\n                else\n                    linkItems.push(item);\n                break;\n            }\n        }\n    }\n    return uniqueBy(linkItems.filter((n) => n), 'id');\n}\nfunction getParentsList(node) {\n    const map = new Map();\n    if (!node)\n        return map;\n    let _parent = node;\n    while (_parent) {\n        map.set(_parent.id, _parent);\n        _parent = _parent.id === root.id ? undefined : _parent.parent;\n    }\n    return map;\n}\nfunction convertNodesToJSON(nodes) {\n    return nodes.map((node) => ({\n        id: node.id,\n        name: node.name,\n    }));\n}\nfunction uniqueBy(arr, key) {\n    return [...new Map(arr.map((item) => [item[key], item])).values()];\n}\n"],"sourceRoot":""}